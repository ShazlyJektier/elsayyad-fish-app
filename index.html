<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Ø§Ù„ØµÙŠØ§Ø¯ Ø¨Ø±Ùˆ | Ø£Ø³Ù…Ø§Ùƒ Ø·Ø§Ø²Ø¬Ø©</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2563eb">
    <link rel="apple-touch-icon" href="icons/icon-192.png">

    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Cairo', sans-serif; background: #f8fafc; -webkit-tap-highlight-color: transparent; }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .glass { background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(10px); border-bottom: 1px solid #e5e7eb; }
        .loader { width: 24px; height: 24px; border: 3px solid #3b82f6; border-bottom-color: transparent; border-radius: 50%; display: inline-block; animation: rotation 1s linear infinite; }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* Animations */
        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slide-up { animation: slideUp 0.3s ease-out forwards; }
    </style>
</head>
<body class="pb-24 select-none">

    <!-- === HEADER === -->
    <nav class="fixed top-0 w-full z-40 glass px-4 py-3 flex justify-between items-center shadow-sm">
        <div class="flex items-center gap-2">
            <div class="bg-blue-100 p-2 rounded-full text-blue-600"><i class="fas fa-fish text-xl"></i></div>
            <div>
                <h1 class="text-lg font-bold text-gray-800 leading-tight">Ø§Ù„ØµÙŠØ§Ø¯ Ø¨Ø±Ùˆ</h1>
                <p class="text-[10px] text-gray-500">Ø·Ø§Ø²Ø¬ Ù…Ù† Ø§Ù„Ø¨Ø­Ø± Ø¥Ù„ÙŠÙƒ ğŸŒŠ</p>
            </div>
        </div>
        <button onclick="ui.toggleCart()" class="relative p-2 text-gray-600 hover:text-blue-600 transition">
            <i class="fas fa-shopping-bag text-2xl"></i>
            <span id="cart-badge" class="absolute top-0 right-0 bg-red-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full hidden">0</span>
        </button>
    </nav>

    <!-- === MAIN CONTENT === -->
    <main class="pt-24 px-4 container mx-auto max-w-md">
        <!-- Hero -->
        <div class="bg-blue-600 text-white rounded-2xl p-6 mb-6 shadow-lg relative overflow-hidden">
            <div class="relative z-10">
                <h2 class="text-2xl font-bold mb-1">ØªØ­Ø¨ ØªØ§ÙƒÙ„ Ø¥ÙŠÙ‡ØŸ ğŸ¦</h2>
                <p class="text-blue-100 text-sm mb-4">Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù† ÙˆÙŠÙˆØµÙ„Ùƒ Ù„Ø­Ø¯ Ø§Ù„Ø¨ÙŠØª</p>
            </div>
            <i class="fas fa-water absolute -bottom-4 -left-4 text-8xl text-white opacity-10"></i>
        </div>

        <!-- Filters -->
        <div class="flex gap-2 overflow-x-auto hide-scroll mb-6 pb-2 sticky top-[70px] z-30 bg-[#f8fafc] pt-2">
            <button onclick="app.filter('all', this)" class="cat-btn bg-blue-600 text-white px-5 py-2 rounded-full text-sm font-bold shadow-md whitespace-nowrap">Ø§Ù„ÙƒÙ„</button>
            <button onclick="app.filter('fresh', this)" class="cat-btn bg-white text-gray-600 px-5 py-2 rounded-full text-sm font-bold border whitespace-nowrap">ğŸŸ Ø·Ø§Ø²Ø¬</button>
            <button onclick="app.filter('grilled', this)" class="cat-btn bg-white text-gray-600 px-5 py-2 rounded-full text-sm font-bold border whitespace-nowrap">ğŸ”¥ Ù…Ø´ÙˆÙŠ</button>
            <button onclick="app.filter('seafood', this)" class="cat-btn bg-white text-gray-600 px-5 py-2 rounded-full text-sm font-bold border whitespace-nowrap">ğŸ¦€ ÙÙˆØ§ÙƒÙ‡ Ø¨Ø­Ø±</button>
        </div>

        <!-- Products -->
        <div id="products-grid" class="grid grid-cols-2 gap-4 min-h-[200px]">
            <div class="col-span-2 text-center py-10"><span class="loader"></span></div>
        </div>
    </main>

    <!-- === CART === -->
    <div id="cart-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="ui.toggleCart()"></div>
        <div class="absolute bottom-0 w-full bg-white rounded-t-3xl shadow-2xl flex flex-col max-h-[85vh] animate-slide-up">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 class="font-bold text-lg">Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ğŸ›’</h3>
                <button onclick="ui.toggleCart()" class="text-gray-500"><i class="fas fa-times"></i></button>
            </div>
            <div id="cart-items" class="flex-1 overflow-y-auto p-4 space-y-4"></div>
            <div class="p-4 border-t bg-gray-50">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-gray-600">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
                    <span id="cart-total" class="text-xl font-bold text-blue-700">0 Ø¬.Ù…</span>
                </div>
                <button onclick="ui.showCheckout()" id="checkout-btn" disabled class="w-full bg-blue-600 text-white py-3.5 rounded-xl font-bold shadow-lg disabled:bg-gray-300">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</button>
            </div>
        </div>
    </div>

    <!-- === CHECKOUT === -->
    <div id="checkout-modal" class="fixed inset-0 z-[60] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-black/70 backdrop-blur-sm"></div>
        <div class="bg-white w-full max-w-sm rounded-2xl p-6 shadow-2xl relative z-10 animate-slide-up">
            <button onclick="ui.hideCheckout()" class="absolute top-4 left-4 text-gray-400"><i class="fas fa-times"></i></button>
            <h3 class="text-xl font-bold mb-6 text-center">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„ ğŸ›µ</h3>
            <form onsubmit="app.submitOrder(event)" class="space-y-4">
                <input type="text" id="c-name" required placeholder="Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„" class="w-full px-4 py-3 bg-gray-50 border rounded-lg focus:border-blue-500 outline-none">
                <input type="tel" id="c-phone" required placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„" class="w-full px-4 py-3 bg-gray-50 border rounded-lg focus:border-blue-500 outline-none">
                <div>
                    <button type="button" onclick="app.getLocation()" id="loc-btn" class="w-full mb-2 bg-green-50 text-green-700 py-2 rounded-lg text-sm font-bold border border-green-200 flex items-center justify-center gap-2">
                        <i class="fas fa-location-dot"></i> ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ÙŠ (GPS)
                    </button>
                    <textarea id="c-address" required placeholder="Ø£Ùˆ Ø§ÙƒØªØ¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø¨Ø§Ù„ØªÙØµÙŠÙ„" class="w-full px-4 py-2 bg-gray-50 border rounded-lg text-sm h-20 resize-none outline-none"></textarea>
                </div>
                <input type="hidden" id="c-lat"><input type="hidden" id="c-lng">
                <button type="submit" id="submit-btn" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold shadow-lg">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ âœ…</button>
            </form>
        </div>
    </div>

    <!-- === CHATBOT === -->
    <button onclick="ui.toggleChat()" class="fixed bottom-6 left-4 bg-gradient-to-tr from-blue-600 to-cyan-500 text-white w-14 h-14 rounded-full shadow-xl flex items-center justify-center z-40 hover:scale-105 transition"><i class="fas fa-robot text-2xl"></i></button>
    <div id="chat-window" class="fixed bottom-24 left-4 w-80 bg-white rounded-2xl shadow-2xl z-50 hidden flex flex-col overflow-hidden border animate-slide-up">
        <div class="bg-blue-600 p-4 text-white flex justify-between items-center">
            <span class="font-bold text-sm">ğŸ‘¨â€ğŸ³ Ø´ÙŠÙ Ø§Ù„ØµÙŠØ§Ø¯</span>
            <button onclick="ui.toggleChat()"><i class="fas fa-times"></i></button>
        </div>
        <div id="chat-messages" class="h-64 p-4 overflow-y-auto bg-gray-50 text-sm space-y-3">
            <div class="bg-white p-3 rounded-2xl rounded-tr-none shadow-sm text-gray-700 max-w-[90%] border">Ø£Ù‡Ù„Ø§Ù‹! Ø§Ø³Ø£Ù„Ù†ÙŠ Ø¹Ù† ÙˆØµÙØ© Ø£ÙŠ Ø³Ù…ÙƒØ© (Ø¬Ù…Ø¨Ø±ÙŠØŒ Ø¨ÙˆØ±ÙŠ...) ğŸ¤</div>
        </div>
        <div class="p-3 border-t flex gap-2">
            <input type="text" id="chat-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø³Ù…ÙƒØ©..." class="flex-1 px-4 py-2 bg-gray-100 rounded-full text-sm outline-none">
            <button onclick="bot.send()" class="bg-blue-600 text-white w-10 h-10 rounded-full flex items-center justify-center"><i class="fas fa-paper-plane text-xs"></i></button>
        </div>
    </div>

    <!-- === ADMIN PANEL === -->
    <div id="admin-login" class="fixed inset-0 z-[100] hidden bg-black/90 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl p-6 w-full max-w-sm">
            <h3 class="font-bold text-xl mb-4 text-center">ğŸ” Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3>
            <input id="adm-email" type="email" placeholder="Email" class="w-full mb-3 p-3 border rounded">
            <input id="adm-pass" type="password" placeholder="Password" class="w-full mb-4 p-3 border rounded">
            <button onclick="admin.login()" class="w-full bg-gray-800 text-white py-3 rounded font-bold">Ø¯Ø®ÙˆÙ„</button>
            <button onclick="document.getElementById('admin-login').classList.add('hidden')" class="w-full mt-3 text-gray-500 text-sm">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <div id="admin-dash" class="hidden fixed inset-0 z-[90] bg-gray-50 overflow-y-auto">
        <div class="bg-gray-800 text-white p-4 sticky top-0 flex justify-between items-center shadow-lg">
            <h2 class="font-bold">ğŸ› ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
            <button onclick="admin.logout()" class="text-red-300 text-xs border border-red-300 px-3 py-1 rounded">Ø®Ø±ÙˆØ¬</button>
        </div>
        <div class="p-4 space-y-6 max-w-2xl mx-auto">
            <div class="bg-white p-4 rounded-xl shadow-sm border">
                <h3 class="font-bold mb-3 text-gray-700 border-b pb-2">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h3>
                <form onsubmit="admin.addProd(event)" class="space-y-3">
                    <input id="p-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" class="w-full p-2 border rounded" required>
                    <div class="flex gap-2">
                        <input id="p-price" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±" class="w-1/2 p-2 border rounded" required>
                        <select id="p-cat" class="w-1/2 p-2 border rounded bg-white"><option value="fresh">Ø·Ø§Ø²Ø¬</option><option value="grilled">Ù…Ø´ÙˆÙŠ</option><option value="seafood">ÙÙˆØ§ÙƒÙ‡ Ø¨Ø­Ø±</option></select>
                    </div>
                    <input id="p-img" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©" class="w-full p-2 border rounded">
                    <button class="w-full bg-green-600 text-white py-2 rounded font-bold">Ø­ÙØ¸</button>
                </form>
            </div>
            <div class="bg-white p-4 rounded-xl shadow-sm border">
                <div class="flex justify-between mb-3 border-b pb-2"><h3 class="font-bold text-gray-700">ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3><button onclick="admin.loadOrders()" class="text-blue-600 text-xs">ØªØ­Ø¯ÙŠØ«</button></div>
                <div id="adm-orders" class="space-y-3"></div>
            </div>
        </div>
    </div>

    <!-- Admin Trigger (Double click footer) -->
    <footer class="text-center py-6 text-gray-300 text-[10px]" ondblclick="document.getElementById('admin-login').classList.remove('hidden')">Admin Access Area</footer>

    <!-- === LOGIC === -->
    <script>
        // --- ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ SUPABASE ---
        const SUPABASE_URL = 'https://dcucpbkmujdccdkxfofa.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_GfyiP7NTctuWTsW27I_vag_f5PpyZ9p';

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        // --- State ---
        const state = { products: [], cart: JSON.parse(localStorage.getItem('cart')) || [], cat: 'all' };

        // --- UI Controllers ---
        const ui = {
            toggleCart: () => {
                const m = document.getElementById('cart-modal');
                m.classList.toggle('hidden');
                if(!m.classList.contains('hidden')) app.renderCart();
            },
            toggleChat: () => document.getElementById('chat-window').classList.toggle('hidden'),
            showCheckout: () => {
                document.getElementById('cart-modal').classList.add('hidden');
                document.getElementById('checkout-modal').classList.remove('hidden');
            },
            hideCheckout: () => document.getElementById('checkout-modal').classList.add('hidden')
        };

        // --- App Logic ---
        const app = {
            init: async () => {
                await app.fetchProds();
                app.updateBadge();
            },
            fetchProds: async () => {
                const { data, error } = await supabase.from('products').select('*').order('created_at', {ascending: false});
                if(error) {
                    console.error(error);
                    // ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ Ø£Ùˆ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙØ§Ø±ØºØ©
                    document.getElementById('products-grid').innerHTML = '<div class="col-span-2 text-center text-red-400 py-10">ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯ Ø¬Ø¯Ø§ÙˆÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>';
                    return;
                }
                state.products = data;
                app.renderProds();
            },
            renderProds: () => {
                const grid = document.getElementById('products-grid');
                grid.innerHTML = '';
                const list = state.cat === 'all' ? state.products : state.products.filter(p => p.category === state.cat);
                
                if(!list || list.length === 0) {
                    grid.innerHTML = '<div class="col-span-2 text-center text-gray-400 py-10">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</div>';
                    return;
                }
                
                list.forEach(p => {
                    grid.innerHTML += `
                        <div class="bg-white rounded-xl shadow-sm border overflow-hidden flex flex-col h-full product-card">
                            <div class="h-32 bg-gray-100 relative">
                                <img src="${p.image_url || 'https://via.placeholder.com/300'}" class="w-full h-full object-cover">
                                <span class="absolute bottom-1 right-1 bg-white/90 px-2 py-0.5 rounded text-xs font-bold shadow">${p.price} Ø¬.Ù…</span>
                            </div>
                            <div class="p-3 flex-1 flex flex-col justify-between">
                                <h3 class="font-bold text-sm text-gray-800 line-clamp-1">${p.name}</h3>
                                <button onclick="app.addCart(${p.id})" class="mt-2 w-full bg-blue-50 text-blue-600 hover:bg-blue-600 hover:text-white py-2 rounded-lg text-xs font-bold transition">Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø© +</button>
                            </div>
                        </div>
                    `;
                });
            },
            filter: (c, el) => {
                state.cat = c;
                document.querySelectorAll('.cat-btn').forEach(b => { b.className = 'cat-btn bg-white text-gray-600 px-5 py-2 rounded-full text-sm font-bold border whitespace-nowrap' });
                el.className = 'cat-btn bg-blue-600 text-white px-5 py-2 rounded-full text-sm font-bold shadow-md whitespace-nowrap';
                app.renderProds();
            },
            addCart: (id) => {
                const p = state.products.find(x => x.id === id);
                const ex = state.cart.find(x => x.id === id);
                if(ex) ex.qty++; else state.cart.push({...p, qty: 1});
                app.save();
                // Ø§Ù‡ØªØ²Ø§Ø² Ø¨Ø³ÙŠØ· Ù„Ù„Ù‡Ø§ØªÙ Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
                if(navigator.vibrate) navigator.vibrate(50);
            },
            modQty: (idx, d) => {
                state.cart[idx].qty += d;
                if(state.cart[idx].qty <= 0) state.cart.splice(idx, 1);
                app.save(); app.renderCart();
            },
            save: () => {
                localStorage.setItem('cart', JSON.stringify(state.cart));
                app.updateBadge();
            },
            updateBadge: () => {
                const c = state.cart.reduce((a,b)=>a+b.qty,0);
                const b = document.getElementById('cart-badge');
                b.innerText = c; b.classList.toggle('hidden', c===0);
            },
            renderCart: () => {
                const el = document.getElementById('cart-items');
                el.innerHTML = '';
                let t = 0;
                if(!state.cart.length) {
                    el.innerHTML = '<div class="text-center text-gray-400 py-10">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</div>';
                    document.getElementById('checkout-btn').disabled = true;
                    document.getElementById('cart-total').innerText = '0 Ø¬.Ù…';
                    return;
                }
                state.cart.forEach((i, idx) => {
                    t += i.price * i.qty;
                    el.innerHTML += `
                        <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg border">
                            <div><p class="font-bold text-sm">${i.name}</p><p class="text-xs text-gray-500">${i.price} Ø¬.Ù…</p></div>
                            <div class="flex items-center gap-2 bg-white border rounded px-1">
                                <button onclick="app.modQty(${idx},-1)" class="w-6 text-red-500 font-bold">-</button>
                                <span class="text-xs font-bold w-4 text-center">${i.qty}</span>
                                <button onclick="app.modQty(${idx},1)" class="w-6 text-green-600 font-bold">+</button>
                            </div>
                        </div>
                    `;
                });
                document.getElementById('cart-total').innerText = t + ' Ø¬.Ù…';
                document.getElementById('checkout-btn').disabled = false;
            },
            getLocation: () => {
                const b = document.getElementById('loc-btn');
                b.innerHTML = '<span class="loader w-4 h-4 border-green-600"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ¯...';
                navigator.geolocation.getCurrentPosition(p => {
                    document.getElementById('c-lat').value = p.coords.latitude;
                    document.getElementById('c-lng').value = p.coords.longitude;
                    document.getElementById('c-address').value = `Ù…ÙˆÙ‚Ø¹ GPS: ${p.coords.latitude.toFixed(5)}, ${p.coords.longitude.toFixed(5)}`;
                    b.innerHTML = 'âœ… ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹'; b.className = b.className.replace('bg-green-50','bg-green-600 text-white');
                }, () => { alert('ÙØ´Ù„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹'); b.innerHTML = 'ğŸ“ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰'; });
            },
            submitOrder: async (e) => {
                e.preventDefault();
                const b = document.getElementById('submit-btn');
                b.disabled = true; b.innerText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
                
                const order = {
                    customer_name: document.getElementById('c-name').value,
                    customer_phone: document.getElementById('c-phone').value,
                    location_text: document.getElementById('c-address').value,
                    lat: document.getElementById('c-lat').value || null,
                    lng: document.getElementById('c-lng').value || null,
                    cart_items: state.cart,
                    total_price: state.cart.reduce((a,b)=>a+(b.price*b.qty),0)
                };

                const { error } = await supabase.from('orders').insert([order]);
                if(error) { alert('Ø®Ø·Ø£: '+error.message); b.disabled = false; b.innerText = 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨'; }
                else {
                    state.cart = []; app.save(); ui.hideCheckout();
                    // Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­ Ù…Ø®ØµØµØ©
                    const successMsg = document.createElement('div');
                    successMsg.classNam